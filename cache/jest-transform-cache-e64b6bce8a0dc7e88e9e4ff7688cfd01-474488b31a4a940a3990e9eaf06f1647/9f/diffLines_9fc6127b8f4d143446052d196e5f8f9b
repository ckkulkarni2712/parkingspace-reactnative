03a83ba413f4ccf074880aaf2e5699bd
'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.printDiffLines = exports.diffLinesUnified2 = exports.diffLinesUnified = exports.diffLinesRaw = void 0;
var _diffSequences = _interopRequireDefault(require('diff-sequences'));
var _cleanupSemantic = require('./cleanupSemantic');
var _joinAlignedDiffs = require('./joinAlignedDiffs');
var _normalizeDiffOptions = require('./normalizeDiffOptions');
function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}
var isEmptyString = function isEmptyString(lines) {
  return lines.length === 1 && lines[0].length === 0;
};
var countChanges = function countChanges(diffs) {
  var a = 0;
  var b = 0;
  diffs.forEach(function (diff) {
    switch (diff[0]) {
      case _cleanupSemantic.DIFF_DELETE:
        a += 1;
        break;
      case _cleanupSemantic.DIFF_INSERT:
        b += 1;
        break;
    }
  });
  return {
    a: a,
    b: b
  };
};
var printAnnotation = function printAnnotation(_ref, changeCounts) {
  var aAnnotation = _ref.aAnnotation,
    aColor = _ref.aColor,
    aIndicator = _ref.aIndicator,
    bAnnotation = _ref.bAnnotation,
    bColor = _ref.bColor,
    bIndicator = _ref.bIndicator,
    includeChangeCounts = _ref.includeChangeCounts,
    omitAnnotationLines = _ref.omitAnnotationLines;
  if (omitAnnotationLines) {
    return '';
  }
  var aRest = '';
  var bRest = '';
  if (includeChangeCounts) {
    var aCount = String(changeCounts.a);
    var bCount = String(changeCounts.b);
    var baAnnotationLengthDiff = bAnnotation.length - aAnnotation.length;
    var aAnnotationPadding = ' '.repeat(Math.max(0, baAnnotationLengthDiff));
    var bAnnotationPadding = ' '.repeat(Math.max(0, -baAnnotationLengthDiff));
    var baCountLengthDiff = bCount.length - aCount.length;
    var aCountPadding = ' '.repeat(Math.max(0, baCountLengthDiff));
    var bCountPadding = ' '.repeat(Math.max(0, -baCountLengthDiff));
    aRest = aAnnotationPadding + "  " + aIndicator + " " + aCountPadding + aCount;
    bRest = bAnnotationPadding + "  " + bIndicator + " " + bCountPadding + bCount;
  }
  var a = aIndicator + " " + aAnnotation + aRest;
  var b = bIndicator + " " + bAnnotation + bRest;
  return aColor(a) + "\n" + bColor(b) + "\n\n";
};
var printDiffLines = function printDiffLines(diffs, options) {
  return printAnnotation(options, countChanges(diffs)) + (options.expand ? (0, _joinAlignedDiffs.joinAlignedDiffsExpand)(diffs, options) : (0, _joinAlignedDiffs.joinAlignedDiffsNoExpand)(diffs, options));
};
exports.printDiffLines = printDiffLines;
var diffLinesUnified = function diffLinesUnified(aLines, bLines, options) {
  return printDiffLines(diffLinesRaw(isEmptyString(aLines) ? [] : aLines, isEmptyString(bLines) ? [] : bLines), (0, _normalizeDiffOptions.normalizeDiffOptions)(options));
};
exports.diffLinesUnified = diffLinesUnified;
var diffLinesUnified2 = function diffLinesUnified2(aLinesDisplay, bLinesDisplay, aLinesCompare, bLinesCompare, options) {
  if (isEmptyString(aLinesDisplay) && isEmptyString(aLinesCompare)) {
    aLinesDisplay = [];
    aLinesCompare = [];
  }
  if (isEmptyString(bLinesDisplay) && isEmptyString(bLinesCompare)) {
    bLinesDisplay = [];
    bLinesCompare = [];
  }
  if (aLinesDisplay.length !== aLinesCompare.length || bLinesDisplay.length !== bLinesCompare.length) {
    return diffLinesUnified(aLinesDisplay, bLinesDisplay, options);
  }
  var diffs = diffLinesRaw(aLinesCompare, bLinesCompare);
  var aIndex = 0;
  var bIndex = 0;
  diffs.forEach(function (diff) {
    switch (diff[0]) {
      case _cleanupSemantic.DIFF_DELETE:
        diff[1] = aLinesDisplay[aIndex];
        aIndex += 1;
        break;
      case _cleanupSemantic.DIFF_INSERT:
        diff[1] = bLinesDisplay[bIndex];
        bIndex += 1;
        break;
      default:
        diff[1] = bLinesDisplay[bIndex];
        aIndex += 1;
        bIndex += 1;
    }
  });
  return printDiffLines(diffs, (0, _normalizeDiffOptions.normalizeDiffOptions)(options));
};
exports.diffLinesUnified2 = diffLinesUnified2;
var diffLinesRaw = function diffLinesRaw(aLines, bLines) {
  var aLength = aLines.length;
  var bLength = bLines.length;
  var isCommon = function isCommon(aIndex, bIndex) {
    return aLines[aIndex] === bLines[bIndex];
  };
  var diffs = [];
  var aIndex = 0;
  var bIndex = 0;
  var foundSubsequence = function foundSubsequence(nCommon, aCommon, bCommon) {
    for (; aIndex !== aCommon; aIndex += 1) {
      diffs.push(new _cleanupSemantic.Diff(_cleanupSemantic.DIFF_DELETE, aLines[aIndex]));
    }
    for (; bIndex !== bCommon; bIndex += 1) {
      diffs.push(new _cleanupSemantic.Diff(_cleanupSemantic.DIFF_INSERT, bLines[bIndex]));
    }
    for (; nCommon !== 0; nCommon -= 1, aIndex += 1, bIndex += 1) {
      diffs.push(new _cleanupSemantic.Diff(_cleanupSemantic.DIFF_EQUAL, bLines[bIndex]));
    }
  };
  (0, _diffSequences.default)(aLength, bLength, isCommon, foundSubsequence);
  for (; aIndex !== aLength; aIndex += 1) {
    diffs.push(new _cleanupSemantic.Diff(_cleanupSemantic.DIFF_DELETE, aLines[aIndex]));
  }
  for (; bIndex !== bLength; bIndex += 1) {
    diffs.push(new _cleanupSemantic.Diff(_cleanupSemantic.DIFF_INSERT, bLines[bIndex]));
  }
  return diffs;
};
exports.diffLinesRaw = diffLinesRaw;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsInByaW50RGlmZkxpbmVzIiwiZGlmZkxpbmVzVW5pZmllZDIiLCJkaWZmTGluZXNVbmlmaWVkIiwiZGlmZkxpbmVzUmF3IiwiX2RpZmZTZXF1ZW5jZXMiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9jbGVhbnVwU2VtYW50aWMiLCJfam9pbkFsaWduZWREaWZmcyIsIl9ub3JtYWxpemVEaWZmT3B0aW9ucyIsIm9iaiIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0IiwiaXNFbXB0eVN0cmluZyIsImxpbmVzIiwibGVuZ3RoIiwiY291bnRDaGFuZ2VzIiwiZGlmZnMiLCJhIiwiYiIsImZvckVhY2giLCJkaWZmIiwiRElGRl9ERUxFVEUiLCJESUZGX0lOU0VSVCIsInByaW50QW5ub3RhdGlvbiIsImNoYW5nZUNvdW50cyIsImFBbm5vdGF0aW9uIiwiYUNvbG9yIiwiYUluZGljYXRvciIsImJBbm5vdGF0aW9uIiwiYkNvbG9yIiwiYkluZGljYXRvciIsImluY2x1ZGVDaGFuZ2VDb3VudHMiLCJvbWl0QW5ub3RhdGlvbkxpbmVzIiwiYVJlc3QiLCJiUmVzdCIsImFDb3VudCIsIlN0cmluZyIsImJDb3VudCIsImJhQW5ub3RhdGlvbkxlbmd0aERpZmYiLCJhQW5ub3RhdGlvblBhZGRpbmciLCJyZXBlYXQiLCJNYXRoIiwibWF4IiwiYkFubm90YXRpb25QYWRkaW5nIiwiYmFDb3VudExlbmd0aERpZmYiLCJhQ291bnRQYWRkaW5nIiwiYkNvdW50UGFkZGluZyIsIm9wdGlvbnMiLCJleHBhbmQiLCJqb2luQWxpZ25lZERpZmZzRXhwYW5kIiwiam9pbkFsaWduZWREaWZmc05vRXhwYW5kIiwiYUxpbmVzIiwiYkxpbmVzIiwibm9ybWFsaXplRGlmZk9wdGlvbnMiLCJhTGluZXNEaXNwbGF5IiwiYkxpbmVzRGlzcGxheSIsImFMaW5lc0NvbXBhcmUiLCJiTGluZXNDb21wYXJlIiwiYUluZGV4IiwiYkluZGV4IiwiYUxlbmd0aCIsImJMZW5ndGgiLCJpc0NvbW1vbiIsImZvdW5kU3Vic2VxdWVuY2UiLCJuQ29tbW9uIiwiYUNvbW1vbiIsImJDb21tb24iLCJwdXNoIiwiRGlmZiIsIkRJRkZfRVFVQUwiXSwic291cmNlcyI6WyJkaWZmTGluZXMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMucHJpbnREaWZmTGluZXMgPVxuICBleHBvcnRzLmRpZmZMaW5lc1VuaWZpZWQyID1cbiAgZXhwb3J0cy5kaWZmTGluZXNVbmlmaWVkID1cbiAgZXhwb3J0cy5kaWZmTGluZXNSYXcgPVxuICAgIHZvaWQgMDtcbnZhciBfZGlmZlNlcXVlbmNlcyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgnZGlmZi1zZXF1ZW5jZXMnKSk7XG52YXIgX2NsZWFudXBTZW1hbnRpYyA9IHJlcXVpcmUoJy4vY2xlYW51cFNlbWFudGljJyk7XG52YXIgX2pvaW5BbGlnbmVkRGlmZnMgPSByZXF1aXJlKCcuL2pvaW5BbGlnbmVkRGlmZnMnKTtcbnZhciBfbm9ybWFsaXplRGlmZk9wdGlvbnMgPSByZXF1aXJlKCcuL25vcm1hbGl6ZURpZmZPcHRpb25zJyk7XG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikge1xuICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDoge2RlZmF1bHQ6IG9ian07XG59XG4vKipcbiAqIENvcHlyaWdodCAoYykgTWV0YSBQbGF0Zm9ybXMsIEluYy4gYW5kIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKi9cblxuY29uc3QgaXNFbXB0eVN0cmluZyA9IGxpbmVzID0+IGxpbmVzLmxlbmd0aCA9PT0gMSAmJiBsaW5lc1swXS5sZW5ndGggPT09IDA7XG5jb25zdCBjb3VudENoYW5nZXMgPSBkaWZmcyA9PiB7XG4gIGxldCBhID0gMDtcbiAgbGV0IGIgPSAwO1xuICBkaWZmcy5mb3JFYWNoKGRpZmYgPT4ge1xuICAgIHN3aXRjaCAoZGlmZlswXSkge1xuICAgICAgY2FzZSBfY2xlYW51cFNlbWFudGljLkRJRkZfREVMRVRFOlxuICAgICAgICBhICs9IDE7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBfY2xlYW51cFNlbWFudGljLkRJRkZfSU5TRVJUOlxuICAgICAgICBiICs9IDE7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiB7XG4gICAgYSxcbiAgICBiXG4gIH07XG59O1xuY29uc3QgcHJpbnRBbm5vdGF0aW9uID0gKFxuICB7XG4gICAgYUFubm90YXRpb24sXG4gICAgYUNvbG9yLFxuICAgIGFJbmRpY2F0b3IsXG4gICAgYkFubm90YXRpb24sXG4gICAgYkNvbG9yLFxuICAgIGJJbmRpY2F0b3IsXG4gICAgaW5jbHVkZUNoYW5nZUNvdW50cyxcbiAgICBvbWl0QW5ub3RhdGlvbkxpbmVzXG4gIH0sXG4gIGNoYW5nZUNvdW50c1xuKSA9PiB7XG4gIGlmIChvbWl0QW5ub3RhdGlvbkxpbmVzKSB7XG4gICAgcmV0dXJuICcnO1xuICB9XG4gIGxldCBhUmVzdCA9ICcnO1xuICBsZXQgYlJlc3QgPSAnJztcbiAgaWYgKGluY2x1ZGVDaGFuZ2VDb3VudHMpIHtcbiAgICBjb25zdCBhQ291bnQgPSBTdHJpbmcoY2hhbmdlQ291bnRzLmEpO1xuICAgIGNvbnN0IGJDb3VudCA9IFN0cmluZyhjaGFuZ2VDb3VudHMuYik7XG5cbiAgICAvLyBQYWRkaW5nIHJpZ2h0IGFsaWducyB0aGUgZW5kcyBvZiB0aGUgYW5ub3RhdGlvbnMuXG4gICAgY29uc3QgYmFBbm5vdGF0aW9uTGVuZ3RoRGlmZiA9IGJBbm5vdGF0aW9uLmxlbmd0aCAtIGFBbm5vdGF0aW9uLmxlbmd0aDtcbiAgICBjb25zdCBhQW5ub3RhdGlvblBhZGRpbmcgPSAnICcucmVwZWF0KE1hdGgubWF4KDAsIGJhQW5ub3RhdGlvbkxlbmd0aERpZmYpKTtcbiAgICBjb25zdCBiQW5ub3RhdGlvblBhZGRpbmcgPSAnICcucmVwZWF0KE1hdGgubWF4KDAsIC1iYUFubm90YXRpb25MZW5ndGhEaWZmKSk7XG5cbiAgICAvLyBQYWRkaW5nIGxlZnQgYWxpZ25zIHRoZSBlbmRzIG9mIHRoZSBjb3VudHMuXG4gICAgY29uc3QgYmFDb3VudExlbmd0aERpZmYgPSBiQ291bnQubGVuZ3RoIC0gYUNvdW50Lmxlbmd0aDtcbiAgICBjb25zdCBhQ291bnRQYWRkaW5nID0gJyAnLnJlcGVhdChNYXRoLm1heCgwLCBiYUNvdW50TGVuZ3RoRGlmZikpO1xuICAgIGNvbnN0IGJDb3VudFBhZGRpbmcgPSAnICcucmVwZWF0KE1hdGgubWF4KDAsIC1iYUNvdW50TGVuZ3RoRGlmZikpO1xuICAgIGFSZXN0ID0gYCR7YUFubm90YXRpb25QYWRkaW5nfSAgJHthSW5kaWNhdG9yfSAke2FDb3VudFBhZGRpbmd9JHthQ291bnR9YDtcbiAgICBiUmVzdCA9IGAke2JBbm5vdGF0aW9uUGFkZGluZ30gICR7YkluZGljYXRvcn0gJHtiQ291bnRQYWRkaW5nfSR7YkNvdW50fWA7XG4gIH1cbiAgY29uc3QgYSA9IGAke2FJbmRpY2F0b3J9ICR7YUFubm90YXRpb259JHthUmVzdH1gO1xuICBjb25zdCBiID0gYCR7YkluZGljYXRvcn0gJHtiQW5ub3RhdGlvbn0ke2JSZXN0fWA7XG4gIHJldHVybiBgJHthQ29sb3IoYSl9XFxuJHtiQ29sb3IoYil9XFxuXFxuYDtcbn07XG5jb25zdCBwcmludERpZmZMaW5lcyA9IChkaWZmcywgb3B0aW9ucykgPT5cbiAgcHJpbnRBbm5vdGF0aW9uKG9wdGlvbnMsIGNvdW50Q2hhbmdlcyhkaWZmcykpICtcbiAgKG9wdGlvbnMuZXhwYW5kXG4gICAgPyAoMCwgX2pvaW5BbGlnbmVkRGlmZnMuam9pbkFsaWduZWREaWZmc0V4cGFuZCkoZGlmZnMsIG9wdGlvbnMpXG4gICAgOiAoMCwgX2pvaW5BbGlnbmVkRGlmZnMuam9pbkFsaWduZWREaWZmc05vRXhwYW5kKShkaWZmcywgb3B0aW9ucykpO1xuXG4vLyBDb21wYXJlIHR3byBhcnJheXMgb2Ygc3RyaW5ncyBsaW5lLWJ5LWxpbmUuIEZvcm1hdCBhcyBjb21wYXJpc29uIGxpbmVzLlxuZXhwb3J0cy5wcmludERpZmZMaW5lcyA9IHByaW50RGlmZkxpbmVzO1xuY29uc3QgZGlmZkxpbmVzVW5pZmllZCA9IChhTGluZXMsIGJMaW5lcywgb3B0aW9ucykgPT5cbiAgcHJpbnREaWZmTGluZXMoXG4gICAgZGlmZkxpbmVzUmF3KFxuICAgICAgaXNFbXB0eVN0cmluZyhhTGluZXMpID8gW10gOiBhTGluZXMsXG4gICAgICBpc0VtcHR5U3RyaW5nKGJMaW5lcykgPyBbXSA6IGJMaW5lc1xuICAgICksXG4gICAgKDAsIF9ub3JtYWxpemVEaWZmT3B0aW9ucy5ub3JtYWxpemVEaWZmT3B0aW9ucykob3B0aW9ucylcbiAgKTtcblxuLy8gR2l2ZW4gdHdvIHBhaXJzIG9mIGFycmF5cyBvZiBzdHJpbmdzOlxuLy8gQ29tcGFyZSB0aGUgcGFpciBvZiBjb21wYXJpc29uIGFycmF5cyBsaW5lLWJ5LWxpbmUuXG4vLyBGb3JtYXQgdGhlIGNvcnJlc3BvbmRpbmcgbGluZXMgaW4gdGhlIHBhaXIgb2YgZGlzcGxheWFibGUgYXJyYXlzLlxuZXhwb3J0cy5kaWZmTGluZXNVbmlmaWVkID0gZGlmZkxpbmVzVW5pZmllZDtcbmNvbnN0IGRpZmZMaW5lc1VuaWZpZWQyID0gKFxuICBhTGluZXNEaXNwbGF5LFxuICBiTGluZXNEaXNwbGF5LFxuICBhTGluZXNDb21wYXJlLFxuICBiTGluZXNDb21wYXJlLFxuICBvcHRpb25zXG4pID0+IHtcbiAgaWYgKGlzRW1wdHlTdHJpbmcoYUxpbmVzRGlzcGxheSkgJiYgaXNFbXB0eVN0cmluZyhhTGluZXNDb21wYXJlKSkge1xuICAgIGFMaW5lc0Rpc3BsYXkgPSBbXTtcbiAgICBhTGluZXNDb21wYXJlID0gW107XG4gIH1cbiAgaWYgKGlzRW1wdHlTdHJpbmcoYkxpbmVzRGlzcGxheSkgJiYgaXNFbXB0eVN0cmluZyhiTGluZXNDb21wYXJlKSkge1xuICAgIGJMaW5lc0Rpc3BsYXkgPSBbXTtcbiAgICBiTGluZXNDb21wYXJlID0gW107XG4gIH1cbiAgaWYgKFxuICAgIGFMaW5lc0Rpc3BsYXkubGVuZ3RoICE9PSBhTGluZXNDb21wYXJlLmxlbmd0aCB8fFxuICAgIGJMaW5lc0Rpc3BsYXkubGVuZ3RoICE9PSBiTGluZXNDb21wYXJlLmxlbmd0aFxuICApIHtcbiAgICAvLyBGYWxsIGJhY2sgdG8gZGlmZiBvZiBkaXNwbGF5IGxpbmVzLlxuICAgIHJldHVybiBkaWZmTGluZXNVbmlmaWVkKGFMaW5lc0Rpc3BsYXksIGJMaW5lc0Rpc3BsYXksIG9wdGlvbnMpO1xuICB9XG4gIGNvbnN0IGRpZmZzID0gZGlmZkxpbmVzUmF3KGFMaW5lc0NvbXBhcmUsIGJMaW5lc0NvbXBhcmUpO1xuXG4gIC8vIFJlcGxhY2UgY29tcGFyaXNvbiBsaW5lcyB3aXRoIGRpc3BsYXlhYmxlIGxpbmVzLlxuICBsZXQgYUluZGV4ID0gMDtcbiAgbGV0IGJJbmRleCA9IDA7XG4gIGRpZmZzLmZvckVhY2goZGlmZiA9PiB7XG4gICAgc3dpdGNoIChkaWZmWzBdKSB7XG4gICAgICBjYXNlIF9jbGVhbnVwU2VtYW50aWMuRElGRl9ERUxFVEU6XG4gICAgICAgIGRpZmZbMV0gPSBhTGluZXNEaXNwbGF5W2FJbmRleF07XG4gICAgICAgIGFJbmRleCArPSAxO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgX2NsZWFudXBTZW1hbnRpYy5ESUZGX0lOU0VSVDpcbiAgICAgICAgZGlmZlsxXSA9IGJMaW5lc0Rpc3BsYXlbYkluZGV4XTtcbiAgICAgICAgYkluZGV4ICs9IDE7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgZGlmZlsxXSA9IGJMaW5lc0Rpc3BsYXlbYkluZGV4XTtcbiAgICAgICAgYUluZGV4ICs9IDE7XG4gICAgICAgIGJJbmRleCArPSAxO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBwcmludERpZmZMaW5lcyhcbiAgICBkaWZmcyxcbiAgICAoMCwgX25vcm1hbGl6ZURpZmZPcHRpb25zLm5vcm1hbGl6ZURpZmZPcHRpb25zKShvcHRpb25zKVxuICApO1xufTtcblxuLy8gQ29tcGFyZSB0d28gYXJyYXlzIG9mIHN0cmluZ3MgbGluZS1ieS1saW5lLlxuZXhwb3J0cy5kaWZmTGluZXNVbmlmaWVkMiA9IGRpZmZMaW5lc1VuaWZpZWQyO1xuY29uc3QgZGlmZkxpbmVzUmF3ID0gKGFMaW5lcywgYkxpbmVzKSA9PiB7XG4gIGNvbnN0IGFMZW5ndGggPSBhTGluZXMubGVuZ3RoO1xuICBjb25zdCBiTGVuZ3RoID0gYkxpbmVzLmxlbmd0aDtcbiAgY29uc3QgaXNDb21tb24gPSAoYUluZGV4LCBiSW5kZXgpID0+IGFMaW5lc1thSW5kZXhdID09PSBiTGluZXNbYkluZGV4XTtcbiAgY29uc3QgZGlmZnMgPSBbXTtcbiAgbGV0IGFJbmRleCA9IDA7XG4gIGxldCBiSW5kZXggPSAwO1xuICBjb25zdCBmb3VuZFN1YnNlcXVlbmNlID0gKG5Db21tb24sIGFDb21tb24sIGJDb21tb24pID0+IHtcbiAgICBmb3IgKDsgYUluZGV4ICE9PSBhQ29tbW9uOyBhSW5kZXggKz0gMSkge1xuICAgICAgZGlmZnMucHVzaChcbiAgICAgICAgbmV3IF9jbGVhbnVwU2VtYW50aWMuRGlmZihfY2xlYW51cFNlbWFudGljLkRJRkZfREVMRVRFLCBhTGluZXNbYUluZGV4XSlcbiAgICAgICk7XG4gICAgfVxuICAgIGZvciAoOyBiSW5kZXggIT09IGJDb21tb247IGJJbmRleCArPSAxKSB7XG4gICAgICBkaWZmcy5wdXNoKFxuICAgICAgICBuZXcgX2NsZWFudXBTZW1hbnRpYy5EaWZmKF9jbGVhbnVwU2VtYW50aWMuRElGRl9JTlNFUlQsIGJMaW5lc1tiSW5kZXhdKVxuICAgICAgKTtcbiAgICB9XG4gICAgZm9yICg7IG5Db21tb24gIT09IDA7IG5Db21tb24gLT0gMSwgYUluZGV4ICs9IDEsIGJJbmRleCArPSAxKSB7XG4gICAgICBkaWZmcy5wdXNoKFxuICAgICAgICBuZXcgX2NsZWFudXBTZW1hbnRpYy5EaWZmKF9jbGVhbnVwU2VtYW50aWMuRElGRl9FUVVBTCwgYkxpbmVzW2JJbmRleF0pXG4gICAgICApO1xuICAgIH1cbiAgfTtcbiAgKDAsIF9kaWZmU2VxdWVuY2VzLmRlZmF1bHQpKGFMZW5ndGgsIGJMZW5ndGgsIGlzQ29tbW9uLCBmb3VuZFN1YnNlcXVlbmNlKTtcblxuICAvLyBBZnRlciB0aGUgbGFzdCBjb21tb24gc3Vic2VxdWVuY2UsIHB1c2ggcmVtYWluaW5nIGNoYW5nZSBpdGVtcy5cbiAgZm9yICg7IGFJbmRleCAhPT0gYUxlbmd0aDsgYUluZGV4ICs9IDEpIHtcbiAgICBkaWZmcy5wdXNoKFxuICAgICAgbmV3IF9jbGVhbnVwU2VtYW50aWMuRGlmZihfY2xlYW51cFNlbWFudGljLkRJRkZfREVMRVRFLCBhTGluZXNbYUluZGV4XSlcbiAgICApO1xuICB9XG4gIGZvciAoOyBiSW5kZXggIT09IGJMZW5ndGg7IGJJbmRleCArPSAxKSB7XG4gICAgZGlmZnMucHVzaChcbiAgICAgIG5ldyBfY2xlYW51cFNlbWFudGljLkRpZmYoX2NsZWFudXBTZW1hbnRpYy5ESUZGX0lOU0VSVCwgYkxpbmVzW2JJbmRleF0pXG4gICAgKTtcbiAgfVxuICByZXR1cm4gZGlmZnM7XG59O1xuZXhwb3J0cy5kaWZmTGluZXNSYXcgPSBkaWZmTGluZXNSYXc7XG4iXSwibWFwcGluZ3MiOiJBQUFBLFlBQVk7O0FBRVpBLE1BQU0sQ0FBQ0MsY0FBYyxDQUFDQyxPQUFPLEVBQUUsWUFBWSxFQUFFO0VBQzNDQyxLQUFLLEVBQUU7QUFDVCxDQUFDLENBQUM7QUFDRkQs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