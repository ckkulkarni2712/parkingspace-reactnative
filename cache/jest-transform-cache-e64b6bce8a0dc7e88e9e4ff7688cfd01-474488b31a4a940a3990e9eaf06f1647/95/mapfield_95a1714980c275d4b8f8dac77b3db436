a2ad7ae94de729c0050f9844f43ebafe
"use strict";

module.exports = MapField;
var Field = require("./field");
((MapField.prototype = Object.create(Field.prototype)).constructor = MapField).className = "MapField";
var types = require("./types"),
  util = require("./util");
function MapField(name, id, keyType, type, options, comment) {
  Field.call(this, name, id, type, undefined, undefined, options, comment);
  if (!util.isString(keyType)) throw TypeError("keyType must be a string");
  this.keyType = keyType;
  this.resolvedKeyType = null;
  this.map = true;
}
MapField.fromJSON = function fromJSON(name, json) {
  return new MapField(name, json.id, json.keyType, json.type, json.options, json.comment);
};
MapField.prototype.toJSON = function toJSON(toJSONOptions) {
  var keepComments = toJSONOptions ? Boolean(toJSONOptions.keepComments) : false;
  return util.toObject(["keyType", this.keyType, "type", this.type, "id", this.id, "extend", this.extend, "options", this.options, "comment", keepComments ? this.comment : undefined]);
};
MapField.prototype.resolve = function resolve() {
  if (this.resolved) return this;
  if (types.mapKey[this.keyType] === undefined) throw Error("invalid key type: " + this.keyType);
  return Field.prototype.resolve.call(this);
};
MapField.d = function decorateMapField(fieldId, fieldKeyType, fieldValueType) {
  if (typeof fieldValueType === "function") fieldValueType = util.decorateType(fieldValueType).name;else if (fieldValueType && typeof fieldValueType === "object") fieldValueType = util.decorateEnum(fieldValueType).name;
  return function mapFieldDecorator(prototype, fieldName) {
    util.decorateType(prototype.constructor).add(new MapField(fieldName, fieldId, fieldKeyType, fieldValueType));
  };
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb2R1bGUiLCJleHBvcnRzIiwiTWFwRmllbGQiLCJGaWVsZCIsInJlcXVpcmUiLCJwcm90b3R5cGUiLCJPYmplY3QiLCJjcmVhdGUiLCJjb25zdHJ1Y3RvciIsImNsYXNzTmFtZSIsInR5cGVzIiwidXRpbCIsIm5hbWUiLCJpZCIsImtleVR5cGUiLCJ0eXBlIiwib3B0aW9ucyIsImNvbW1lbnQiLCJjYWxsIiwidW5kZWZpbmVkIiwiaXNTdHJpbmciLCJUeXBlRXJyb3IiLCJyZXNvbHZlZEtleVR5cGUiLCJtYXAiLCJmcm9tSlNPTiIsImpzb24iLCJ0b0pTT04iLCJ0b0pTT05PcHRpb25zIiwia2VlcENvbW1lbnRzIiwiQm9vbGVhbiIsInRvT2JqZWN0IiwiZXh0ZW5kIiwicmVzb2x2ZSIsInJlc29sdmVkIiwibWFwS2V5IiwiRXJyb3IiLCJkIiwiZGVjb3JhdGVNYXBGaWVsZCIsImZpZWxkSWQiLCJmaWVsZEtleVR5cGUiLCJmaWVsZFZhbHVlVHlwZSIsImRlY29yYXRlVHlwZSIsImRlY29yYXRlRW51bSIsIm1hcEZpZWxkRGVjb3JhdG9yIiwiZmllbGROYW1lIiwiYWRkIl0sInNvdXJjZXMiOlsibWFwZmllbGQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5tb2R1bGUuZXhwb3J0cyA9IE1hcEZpZWxkO1xuXG4vLyBleHRlbmRzIEZpZWxkXG52YXIgRmllbGQgPSByZXF1aXJlKFwiLi9maWVsZFwiKTtcbigoTWFwRmllbGQucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShGaWVsZC5wcm90b3R5cGUpKS5jb25zdHJ1Y3RvciA9IE1hcEZpZWxkKS5jbGFzc05hbWUgPSBcIk1hcEZpZWxkXCI7XG5cbnZhciB0eXBlcyAgID0gcmVxdWlyZShcIi4vdHlwZXNcIiksXG4gICAgdXRpbCAgICA9IHJlcXVpcmUoXCIuL3V0aWxcIik7XG5cbi8qKlxuICogQ29uc3RydWN0cyBhIG5ldyBtYXAgZmllbGQgaW5zdGFuY2UuXG4gKiBAY2xhc3NkZXNjIFJlZmxlY3RlZCBtYXAgZmllbGQuXG4gKiBAZXh0ZW5kcyBGaWVsZEJhc2VcbiAqIEBjb25zdHJ1Y3RvclxuICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgVW5pcXVlIG5hbWUgd2l0aGluIGl0cyBuYW1lc3BhY2VcbiAqIEBwYXJhbSB7bnVtYmVyfSBpZCBVbmlxdWUgaWQgd2l0aGluIGl0cyBuYW1lc3BhY2VcbiAqIEBwYXJhbSB7c3RyaW5nfSBrZXlUeXBlIEtleSB0eXBlXG4gKiBAcGFyYW0ge3N0cmluZ30gdHlwZSBWYWx1ZSB0eXBlXG4gKiBAcGFyYW0ge09iamVjdC48c3RyaW5nLCo+fSBbb3B0aW9uc10gRGVjbGFyZWQgb3B0aW9uc1xuICogQHBhcmFtIHtzdHJpbmd9IFtjb21tZW50XSBDb21tZW50IGFzc29jaWF0ZWQgd2l0aCB0aGlzIGZpZWxkXG4gKi9cbmZ1bmN0aW9uIE1hcEZpZWxkKG5hbWUsIGlkLCBrZXlUeXBlLCB0eXBlLCBvcHRpb25zLCBjb21tZW50KSB7XG4gICAgRmllbGQuY2FsbCh0aGlzLCBuYW1lLCBpZCwgdHlwZSwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIG9wdGlvbnMsIGNvbW1lbnQpO1xuXG4gICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovXG4gICAgaWYgKCF1dGlsLmlzU3RyaW5nKGtleVR5cGUpKVxuICAgICAgICB0aHJvdyBUeXBlRXJyb3IoXCJrZXlUeXBlIG11c3QgYmUgYSBzdHJpbmdcIik7XG5cbiAgICAvKipcbiAgICAgKiBLZXkgdHlwZS5cbiAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAqL1xuICAgIHRoaXMua2V5VHlwZSA9IGtleVR5cGU7IC8vIHRvSlNPTiwgbWFya2VyXG5cbiAgICAvKipcbiAgICAgKiBSZXNvbHZlZCBrZXkgdHlwZSBpZiBub3QgYSBiYXNpYyB0eXBlLlxuICAgICAqIEB0eXBlIHtSZWZsZWN0aW9uT2JqZWN0fG51bGx9XG4gICAgICovXG4gICAgdGhpcy5yZXNvbHZlZEtleVR5cGUgPSBudWxsO1xuXG4gICAgLy8gT3ZlcnJpZGVzIEZpZWxkI21hcFxuICAgIHRoaXMubWFwID0gdHJ1ZTtcbn1cblxuLyoqXG4gKiBNYXAgZmllbGQgZGVzY3JpcHRvci5cbiAqIEBpbnRlcmZhY2UgSU1hcEZpZWxkXG4gKiBAZXh0ZW5kcyB7SUZpZWxkfVxuICogQHByb3BlcnR5IHtzdHJpbmd9IGtleVR5cGUgS2V5IHR5cGVcbiAqL1xuXG4vKipcbiAqIEV4dGVuc2lvbiBtYXAgZmllbGQgZGVzY3JpcHRvci5cbiAqIEBpbnRlcmZhY2UgSUV4dGVuc2lvbk1hcEZpZWxkXG4gKiBAZXh0ZW5kcyBJTWFwRmllbGRcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBleHRlbmQgRXh0ZW5kZWQgdHlwZVxuICovXG5cbi8qKlxuICogQ29uc3RydWN0cyBhIG1hcCBmaWVsZCBmcm9tIGEgbWFwIGZpZWxkIGRlc2NyaXB0b3IuXG4gKiBAcGFyYW0ge3N0cmluZ30gbmFtZSBGaWVsZCBuYW1lXG4gKiBAcGFyYW0ge0lNYXBGaWVsZH0ganNvbiBNYXAgZmllbGQgZGVzY3JpcHRvclxuICogQHJldHVybnMge01hcEZpZWxkfSBDcmVhdGVkIG1hcCBmaWVsZFxuICogQHRocm93cyB7VHlwZUVycm9yfSBJZiBhcmd1bWVudHMgYXJlIGludmFsaWRcbiAqL1xuTWFwRmllbGQuZnJvbUpTT04gPSBmdW5jdGlvbiBmcm9tSlNPTihuYW1lLCBqc29uKSB7XG4gICAgcmV0dXJuIG5ldyBNYXBGaWVsZChuYW1lLCBqc29uLmlkLCBqc29uLmtleVR5cGUsIGpzb24udHlwZSwganNvbi5vcHRpb25zLCBqc29uLmNvbW1lbnQpO1xufTtcblxuLyoqXG4gKiBDb252ZXJ0cyB0aGlzIG1hcCBmaWVsZCB0byBhIG1hcCBmaWVsZCBkZXNjcmlwdG9yLlxuICogQHBhcmFtIHtJVG9KU09OT3B0aW9uc30gW3RvSlNPTk9wdGlvbnNdIEpTT04gY29udmVyc2lvbiBvcHRpb25zXG4gKiBAcmV0dXJucyB7SU1hcEZpZWxkfSBNYXAgZmllbGQgZGVzY3JpcHRvclxuICovXG5NYXBGaWVsZC5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gdG9KU09OKHRvSlNPTk9wdGlvbnMpIHtcbiAgICB2YXIga2VlcENvbW1lbnRzID0gdG9KU09OT3B0aW9ucyA/IEJvb2xlYW4odG9KU09OT3B0aW9ucy5rZWVwQ29tbWVudHMpIDogZmFsc2U7XG4gICAgcmV0dXJuIHV0aWwudG9PYmplY3QoW1xuICAgICAgICBcImtleVR5cGVcIiAsIHRoaXMua2V5VHlwZSxcbiAgICAgICAgXCJ0eXBlXCIgICAgLCB0aGlzLnR5cGUsXG4gICAgICAgIFwiaWRcIiAgICAgICwgdGhpcy5pZCxcbiAgICAgICAgXCJleHRlbmRcIiAgLCB0aGlzLmV4dGVuZCxcbiAgICAgICAgXCJvcHRpb25zXCIgLCB0aGlzLm9wdGlvbnMsXG4gICAgICAgIFwiY29tbWVudFwiICwga2VlcENvbW1lbnRzID8gdGhpcy5jb21tZW50IDogdW5kZWZpbmVkXG4gICAgXSk7XG59O1xuXG4vKipcbiAqIEBvdmVycmlkZVxuICovXG5NYXBGaWVsZC5wcm90b3R5cGUucmVzb2x2ZSA9IGZ1bmN0aW9uIHJlc29sdmUoKSB7XG4gICAgaWYgKHRoaXMucmVzb2x2ZWQpXG4gICAgICAgIHJldHVybiB0aGlzO1xuXG4gICAgLy8gQmVzaWRlcyBhIHZhbHVlIHR5cGUsIG1hcCBmaWVsZHMgaGF2ZSBhIGtleSB0eXBlIHRoYXQgbWF5IGJlIFwiYW55IHNjYWxhciB0eXBlIGV4Y2VwdCBmb3IgZmxvYXRpbmcgcG9pbnQgdHlwZXMgYW5kIGJ5dGVzXCJcbiAgICBpZiAodHlwZXMubWFwS2V5W3RoaXMua2V5VHlwZV0gPT09IHVuZGVmaW5lZClcbiAgICAgICAgdGhyb3cgRXJyb3IoXCJpbnZhbGlkIGtleSB0eXBlOiBcIiArIHRoaXMua2V5VHlwZSk7XG5cbiAgICByZXR1cm4gRmllbGQucHJvdG90eXBlLnJlc29sdmUuY2FsbCh0aGlzKTtcbn07XG5cbi8qKlxuICogTWFwIGZpZWxkIGRlY29yYXRvciAoVHlwZVNjcmlwdCkuXG4gKiBAbmFtZSBNYXBGaWVsZC5kXG4gKiBAZnVuY3Rpb25cbiAqIEBwYXJhbSB7bnVtYmVyfSBmaWVsZElkIEZpZWxkIGlkXG4gKiBAcGFyYW0ge1wiaW50MzJcInxcInVpbnQzMlwifFwic2ludDMyXCJ8XCJmaXhlZDMyXCJ8XCJzZml4ZWQzMlwifFwiaW50NjRcInxcInVpbnQ2NFwifFwic2ludDY0XCJ8XCJmaXhlZDY0XCJ8XCJzZml4ZWQ2NFwifFwiYm9vbFwifFwic3RyaW5nXCJ9IGZpZWxkS2V5VHlwZSBGaWVsZCBrZXkgdHlwZVxuICogQHBhcmFtIHtcImRvdWJsZVwifFwiZmxvYXRcInxcImludDMyXCJ8XCJ1aW50MzJcInxcInNpbnQzMlwifFwiZml4ZWQzMlwifFwic2ZpeGVkMzJcInxcImludDY0XCJ8XCJ1aW50NjRcInxcInNpbnQ2NFwifFwiZml4ZWQ2NFwifFwic2ZpeGVkNjRcInxcImJvb2xcInxcInN0cmluZ1wifFwiYnl0ZXNcInxPYmplY3R8Q29uc3RydWN0b3I8e30+fSBmaWVsZFZhbHVlVHlwZSBGaWVsZCB2YWx1ZSB0eXBlXG4gKiBAcmV0dXJucyB7RmllbGREZWNvcmF0b3J9IERlY29yYXRvciBmdW5jdGlvblxuICogQHRlbXBsYXRlIFQgZXh0ZW5kcyB7IFtrZXk6IHN0cmluZ106IG51bWJlciB8IExvbmcgfCBzdHJpbmcgfCBib29sZWFuIHwgVWludDhBcnJheSB8IEJ1ZmZlciB8IG51bWJlcltdIHwgTWVzc2FnZTx7fT4gfVxuICovXG5NYXBGaWVsZC5kID0gZnVuY3Rpb24gZGVjb3JhdGVNYXBGaWVsZChmaWVsZElkLCBmaWVsZEtleVR5cGUsIGZpZWxkVmFsdWVUeXBlKSB7XG5cbiAgICAvLyBzdWJtZXNzYWdlIHZhbHVlOiBkZWNvcmF0ZSB0aGUgc3VibWVzc2FnZSBhbmQgdXNlIGl0cyBuYW1lIGFzIHRoZSB0eXBlXG4gICAgaWYgKHR5cGVvZiBmaWVsZFZhbHVlVHlwZSA9PT0gXCJmdW5jdGlvblwiKVxuICAgICAgICBmaWVsZFZhbHVlVHlwZSA9IHV0aWwuZGVjb3JhdGVUeXBlKGZpZWxkVmFsdWVUeXBlKS5uYW1lO1xuXG4gICAgLy8gZW51bSByZWZlcmVuY2UgdmFsdWU6IGNyZWF0ZSBhIHJlZmxlY3RlZCBjb3B5IG9mIHRoZSBlbnVtIGFuZCBrZWVwIHJldXNlaW5nIGl0XG4gICAgZWxzZSBpZiAoZmllbGRWYWx1ZVR5cGUgJiYgdHlwZW9mIGZpZWxkVmFsdWVUeXBlID09PSBcIm9iamVjdFwiKVxuICAgICAgICBmaWVsZFZhbHVlVHlwZSA9IHV0aWwuZGVjb3JhdGVFbnVtKGZpZWxkVmFsdWVUeXBlKS5uYW1lO1xuXG4gICAgcmV0dXJuIGZ1bmN0aW9uIG1hcEZpZWxkRGVjb3JhdG9yKHByb3RvdHlwZSwgZmllbGROYW1lKSB7XG4gICAgICAgIHV0aWwuZGVjb3JhdGVUeXBlKHByb3RvdHlwZS5jb25zdHJ1Y3RvcilcbiAgICAgICAgICAgIC5hZGQobmV3IE1hcEZpZWxkKGZpZWxkTmFtZSwgZmllbGRJZCwgZmllbGRLZXlUeXBlLCBmaWVsZFZhbHVlVHlwZSkpO1xuICAgIH07XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZOztBQUNaQSxNQUFNLENBQUNDLE9BQU8sR0FBR0MsUUFBUTtBQUd6QixJQUFJQyxLQUFLLEdBQUdDLE9BQU8sQ0FBQyxTQUFTLENBQUM7QUFDOUIsQ0FBQyxDQUFDRixRQUFRLENBQUNHLFNBQVMsR0FBR0MsTUFBTSxDQUFDQyxNQUFNLENBQUNKLEtBQUssQ0FBQ0UsU0FBUyxDQUFDLEVBQUVHLFdBQVcsR0FBR04sUUFBUSxFQUFFTyxTQUFTLEdBQUcsVUFBVTtBQUVyRyxJQUFJQyxLQUFLLEdBQUtOLE9BQU8sQ0FBQyxTQUFTLENBQUM7RUFDNUJPLElBQUksR0FBTVAsT0FBTyxDQUFDLFFBQVEsQ0FBQztBQWMvQixTQUFTRixRQUFRLENBQUNVLElBQUksRUFBRUMsRUFBRSxFQUFFQyxPQUFPLEVBQUVDLElBQUksRUFBRUMsT0FBTyxFQUFFQyxPQUFPLEVBQUU7RUFDekRkLEtBQUssQ0FBQ2UsSUFBSSxDQUFDLElBQUksRUFBRU4sSUFBSSxF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