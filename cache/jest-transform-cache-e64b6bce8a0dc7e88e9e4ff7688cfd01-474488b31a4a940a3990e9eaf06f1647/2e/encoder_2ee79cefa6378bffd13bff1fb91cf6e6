19d7e6fabdd2c1e4551c8f39147f58c4
"use strict";

module.exports = encoder;
var Enum = require("./enum"),
  types = require("./types"),
  util = require("./util");
function genTypePartial(gen, field, fieldIndex, ref) {
  return field.resolvedType.group ? gen("types[%i].encode(%s,w.uint32(%i)).uint32(%i)", fieldIndex, ref, (field.id << 3 | 3) >>> 0, (field.id << 3 | 4) >>> 0) : gen("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()", fieldIndex, ref, (field.id << 3 | 2) >>> 0);
}
function encoder(mtype) {
  var gen = util.codegen(["m", "w"], mtype.name + "$encode")("if(!w)")("w=Writer.create()");
  var i, ref;
  var fields = mtype.fieldsArray.slice().sort(util.compareFieldsById);
  for (var i = 0; i < fields.length; ++i) {
    var field = fields[i].resolve(),
      index = mtype._fieldsArray.indexOf(field),
      type = field.resolvedType instanceof Enum ? "int32" : field.type,
      wireType = types.basic[type];
    ref = "m" + util.safeProp(field.name);
    if (field.map) {
      gen("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){", ref, field.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){", ref)("w.uint32(%i).fork().uint32(%i).%s(ks[i])", (field.id << 3 | 2) >>> 0, 8 | types.mapKey[field.keyType], field.keyType);
      if (wireType === undefined) gen("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()", index, ref);else gen(".uint32(%i).%s(%s[ks[i]]).ldelim()", 16 | wireType, type, ref);
      gen("}")("}");
    } else if (field.repeated) {
      gen("if(%s!=null&&%s.length){", ref, ref);
      if (field.packed && types.packed[type] !== undefined) {
        gen("w.uint32(%i).fork()", (field.id << 3 | 2) >>> 0)("for(var i=0;i<%s.length;++i)", ref)("w.%s(%s[i])", type, ref)("w.ldelim()");
      } else {
        gen("for(var i=0;i<%s.length;++i)", ref);
        if (wireType === undefined) genTypePartial(gen, field, index, ref + "[i]");else gen("w.uint32(%i).%s(%s[i])", (field.id << 3 | wireType) >>> 0, type, ref);
      }
      gen("}");
    } else {
      if (field.optional) gen("if(%s!=null&&Object.hasOwnProperty.call(m,%j))", ref, field.name);
      if (wireType === undefined) genTypePartial(gen, field, index, ref);else gen("w.uint32(%i).%s(%s)", (field.id << 3 | wireType) >>> 0, type, ref);
    }
  }
  return gen("return w");
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb2R1bGUiLCJleHBvcnRzIiwiZW5jb2RlciIsIkVudW0iLCJyZXF1aXJlIiwidHlwZXMiLCJ1dGlsIiwiZ2VuVHlwZVBhcnRpYWwiLCJnZW4iLCJmaWVsZCIsImZpZWxkSW5kZXgiLCJyZWYiLCJyZXNvbHZlZFR5cGUiLCJncm91cCIsImlkIiwibXR5cGUiLCJjb2RlZ2VuIiwibmFtZSIsImkiLCJmaWVsZHMiLCJmaWVsZHNBcnJheSIsInNsaWNlIiwic29ydCIsImNvbXBhcmVGaWVsZHNCeUlkIiwibGVuZ3RoIiwicmVzb2x2ZSIsImluZGV4IiwiX2ZpZWxkc0FycmF5IiwiaW5kZXhPZiIsInR5cGUiLCJ3aXJlVHlwZSIsImJhc2ljIiwic2FmZVByb3AiLCJtYXAiLCJtYXBLZXkiLCJrZXlUeXBlIiwidW5kZWZpbmVkIiwicmVwZWF0ZWQiLCJwYWNrZWQiLCJvcHRpb25hbCJdLCJzb3VyY2VzIjpbImVuY29kZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5tb2R1bGUuZXhwb3J0cyA9IGVuY29kZXI7XG5cbnZhciBFbnVtICAgICA9IHJlcXVpcmUoXCIuL2VudW1cIiksXG4gICAgdHlwZXMgICAgPSByZXF1aXJlKFwiLi90eXBlc1wiKSxcbiAgICB1dGlsICAgICA9IHJlcXVpcmUoXCIuL3V0aWxcIik7XG5cbi8qKlxuICogR2VuZXJhdGVzIGEgcGFydGlhbCBtZXNzYWdlIHR5cGUgZW5jb2Rlci5cbiAqIEBwYXJhbSB7Q29kZWdlbn0gZ2VuIENvZGVnZW4gaW5zdGFuY2VcbiAqIEBwYXJhbSB7RmllbGR9IGZpZWxkIFJlZmxlY3RlZCBmaWVsZFxuICogQHBhcmFtIHtudW1iZXJ9IGZpZWxkSW5kZXggRmllbGQgaW5kZXhcbiAqIEBwYXJhbSB7c3RyaW5nfSByZWYgVmFyaWFibGUgcmVmZXJlbmNlXG4gKiBAcmV0dXJucyB7Q29kZWdlbn0gQ29kZWdlbiBpbnN0YW5jZVxuICogQGlnbm9yZVxuICovXG5mdW5jdGlvbiBnZW5UeXBlUGFydGlhbChnZW4sIGZpZWxkLCBmaWVsZEluZGV4LCByZWYpIHtcbiAgICByZXR1cm4gZmllbGQucmVzb2x2ZWRUeXBlLmdyb3VwXG4gICAgICAgID8gZ2VuKFwidHlwZXNbJWldLmVuY29kZSglcyx3LnVpbnQzMiglaSkpLnVpbnQzMiglaSlcIiwgZmllbGRJbmRleCwgcmVmLCAoZmllbGQuaWQgPDwgMyB8IDMpID4+PiAwLCAoZmllbGQuaWQgPDwgMyB8IDQpID4+PiAwKVxuICAgICAgICA6IGdlbihcInR5cGVzWyVpXS5lbmNvZGUoJXMsdy51aW50MzIoJWkpLmZvcmsoKSkubGRlbGltKClcIiwgZmllbGRJbmRleCwgcmVmLCAoZmllbGQuaWQgPDwgMyB8IDIpID4+PiAwKTtcbn1cblxuLyoqXG4gKiBHZW5lcmF0ZXMgYW4gZW5jb2RlciBzcGVjaWZpYyB0byB0aGUgc3BlY2lmaWVkIG1lc3NhZ2UgdHlwZS5cbiAqIEBwYXJhbSB7VHlwZX0gbXR5cGUgTWVzc2FnZSB0eXBlXG4gKiBAcmV0dXJucyB7Q29kZWdlbn0gQ29kZWdlbiBpbnN0YW5jZVxuICovXG5mdW5jdGlvbiBlbmNvZGVyKG10eXBlKSB7XG4gICAgLyogZXNsaW50LWRpc2FibGUgbm8tdW5leHBlY3RlZC1tdWx0aWxpbmUsIGJsb2NrLXNjb3BlZC12YXIsIG5vLXJlZGVjbGFyZSAqL1xuICAgIHZhciBnZW4gPSB1dGlsLmNvZGVnZW4oW1wibVwiLCBcIndcIl0sIG10eXBlLm5hbWUgKyBcIiRlbmNvZGVcIilcbiAgICAoXCJpZighdylcIilcbiAgICAgICAgKFwidz1Xcml0ZXIuY3JlYXRlKClcIik7XG5cbiAgICB2YXIgaSwgcmVmO1xuXG4gICAgLy8gXCJ3aGVuIGEgbWVzc2FnZSBpcyBzZXJpYWxpemVkIGl0cyBrbm93biBmaWVsZHMgc2hvdWxkIGJlIHdyaXR0ZW4gc2VxdWVudGlhbGx5IGJ5IGZpZWxkIG51bWJlclwiXG4gICAgdmFyIGZpZWxkcyA9IC8qIGluaXRpYWxpemVzICovIG10eXBlLmZpZWxkc0FycmF5LnNsaWNlKCkuc29ydCh1dGlsLmNvbXBhcmVGaWVsZHNCeUlkKTtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgIHZhciBmaWVsZCAgICA9IGZpZWxkc1tpXS5yZXNvbHZlKCksXG4gICAgICAgICAgICBpbmRleCAgICA9IG10eXBlLl9maWVsZHNBcnJheS5pbmRleE9mKGZpZWxkKSxcbiAgICAgICAgICAgIHR5cGUgICAgID0gZmllbGQucmVzb2x2ZWRUeXBlIGluc3RhbmNlb2YgRW51bSA/IFwiaW50MzJcIiA6IGZpZWxkLnR5cGUsXG4gICAgICAgICAgICB3aXJlVHlwZSA9IHR5cGVzLmJhc2ljW3R5cGVdO1xuICAgICAgICAgICAgcmVmICAgICAgPSBcIm1cIiArIHV0aWwuc2FmZVByb3AoZmllbGQubmFtZSk7XG5cbiAgICAgICAgLy8gTWFwIGZpZWxkc1xuICAgICAgICBpZiAoZmllbGQubWFwKSB7XG4gICAgICAgICAgICBnZW5cbiAgICAoXCJpZiglcyE9bnVsbCYmT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwobSwlaikpe1wiLCByZWYsIGZpZWxkLm5hbWUpIC8vICE9PSB1bmRlZmluZWQgJiYgIT09IG51bGxcbiAgICAgICAgKFwiZm9yKHZhciBrcz1PYmplY3Qua2V5cyglcyksaT0wO2k8a3MubGVuZ3RoOysraSl7XCIsIHJlZilcbiAgICAgICAgICAgIChcIncudWludDMyKCVpKS5mb3JrKCkudWludDMyKCVpKS4lcyhrc1tpXSlcIiwgKGZpZWxkLmlkIDw8IDMgfCAyKSA+Pj4gMCwgOCB8IHR5cGVzLm1hcEtleVtmaWVsZC5rZXlUeXBlXSwgZmllbGQua2V5VHlwZSk7XG4gICAgICAgICAgICBpZiAod2lyZVR5cGUgPT09IHVuZGVmaW5lZCkgZ2VuXG4gICAgICAgICAgICAoXCJ0eXBlc1slaV0uZW5jb2RlKCVzW2tzW2ldXSx3LnVpbnQzMigxOCkuZm9yaygpKS5sZGVsaW0oKS5sZGVsaW0oKVwiLCBpbmRleCwgcmVmKTsgLy8gY2FuJ3QgYmUgZ3JvdXBzXG4gICAgICAgICAgICBlbHNlIGdlblxuICAgICAgICAgICAgKFwiLnVpbnQzMiglaSkuJXMoJXNba3NbaV1dKS5sZGVsaW0oKVwiLCAxNiB8IHdpcmVUeXBlLCB0eXBlLCByZWYpO1xuICAgICAgICAgICAgZ2VuXG4gICAgICAgIChcIn1cIilcbiAgICAoXCJ9XCIpO1xuXG4gICAgICAgICAgICAvLyBSZXBlYXRlZCBmaWVsZHNcbiAgICAgICAgfSBlbHNlIGlmIChmaWVsZC5yZXBlYXRlZCkgeyBnZW5cbiAgICAoXCJpZiglcyE9bnVsbCYmJXMubGVuZ3RoKXtcIiwgcmVmLCByZWYpOyAvLyAhPT0gdW5kZWZpbmVkICYmICE9PSBudWxsXG5cbiAgICAgICAgICAgIC8vIFBhY2tlZCByZXBlYXRlZFxuICAgICAgICAgICAgaWYgKGZpZWxkLnBhY2tlZCAmJiB0eXBlcy5wYWNrZWRbdHlwZV0gIT09IHVuZGVmaW5lZCkgeyBnZW5cblxuICAgICAgICAoXCJ3LnVpbnQzMiglaSkuZm9yaygpXCIsIChmaWVsZC5pZCA8PCAzIHwgMikgPj4+IDApXG4gICAgICAgIChcImZvcih2YXIgaT0wO2k8JXMubGVuZ3RoOysraSlcIiwgcmVmKVxuICAgICAgICAgICAgKFwidy4lcyglc1tpXSlcIiwgdHlwZSwgcmVmKVxuICAgICAgICAoXCJ3LmxkZWxpbSgpXCIpO1xuXG4gICAgICAgICAgICAvLyBOb24tcGFja2VkXG4gICAgICAgICAgICB9IGVsc2UgeyBnZW5cblxuICAgICAgICAoXCJmb3IodmFyIGk9MDtpPCVzLmxlbmd0aDsrK2kpXCIsIHJlZik7XG4gICAgICAgICAgICAgICAgaWYgKHdpcmVUeXBlID09PSB1bmRlZmluZWQpXG4gICAgICAgICAgICBnZW5UeXBlUGFydGlhbChnZW4sIGZpZWxkLCBpbmRleCwgcmVmICsgXCJbaV1cIik7XG4gICAgICAgICAgICAgICAgZWxzZSBnZW5cbiAgICAgICAgICAgIChcIncudWludDMyKCVpKS4lcyglc1tpXSlcIiwgKGZpZWxkLmlkIDw8IDMgfCB3aXJlVHlwZSkgPj4+IDAsIHR5cGUsIHJlZik7XG5cbiAgICAgICAgICAgIH0gZ2VuXG4gICAgKFwifVwiKTtcblxuICAgICAgICAvLyBOb24tcmVwZWF0ZWRcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChmaWVsZC5vcHRpb25hbCkgZ2VuXG4gICAgKFwiaWYoJXMhPW51bGwmJk9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKG0sJWopKVwiLCByZWYsIGZpZWxkLm5hbWUpOyAvLyAhPT0gdW5kZWZpbmVkICYmICE9PSBudWxsXG5cbiAgICAgICAgICAgIGlmICh3aXJlVHlwZSA9PT0gdW5kZWZpbmVkKVxuICAgICAgICBnZW5UeXBlUGFydGlhbChnZW4sIGZpZWxkLCBpbmRleCwgcmVmKTtcbiAgICAgICAgICAgIGVsc2UgZ2VuXG4gICAgICAgIChcIncudWludDMyKCVpKS4lcyglcylcIiwgKGZpZWxkLmlkIDw8IDMgfCB3aXJlVHlwZSkgPj4+IDAsIHR5cGUsIHJlZik7XG5cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBnZW5cbiAgICAoXCJyZXR1cm4gd1wiKTtcbiAgICAvKiBlc2xpbnQtZW5hYmxlIG5vLXVuZXhwZWN0ZWQtbXVsdGlsaW5lLCBibG9jay1zY29wZWQtdmFyLCBuby1yZWRlY2xhcmUgKi9cbn1cbiJdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWTs7QUFDWkEsTUFBTSxDQUFDQyxPQUFPLEdBQUdDLE9BQU87QUFFeEIsSUFBSUMsSUFBSSxHQUFPQyxPQUFPLENBQUMsUUFBUSxDQUFDO0VBQzVCQyxLQUFLLEdBQU1ELE9BQU8sQ0FBQyxTQUFTLENBQUM7RUFDN0JFLElBQUksR0FBT0YsT0FBTyxDQUFDLFFBQVEsQ0FBQztBQVdoQyxTQUFTRyxjQUFjLENBQUNDLEdBQUcsRUFBRUMsS0FBSyxFQUFFQyxVQUFVLEVBQUVDLEdBQUcsRUFBRTtFQUNqRCxPQUFPRixLQUFLLENBQUNHLFlBQVksQ0FBQ0MsS0FBSyxHQUN6QkwsR0FBRyxDQUFDLDhD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