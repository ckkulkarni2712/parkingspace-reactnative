5c522c637d7c34fdc7231f9e8d6a93d4
module.exports = realpath;
realpath.realpath = realpath;
realpath.sync = realpathSync;
realpath.realpathSync = realpathSync;
realpath.monkeypatch = monkeypatch;
realpath.unmonkeypatch = unmonkeypatch;
var fs = require('fs');
var origRealpath = fs.realpath;
var origRealpathSync = fs.realpathSync;
var version = process.version;
var ok = /^v[0-5]\./.test(version);
var old = require('./old.js');
function newError(er) {
  return er && er.syscall === 'realpath' && (er.code === 'ELOOP' || er.code === 'ENOMEM' || er.code === 'ENAMETOOLONG');
}
function realpath(p, cache, cb) {
  if (ok) {
    return origRealpath(p, cache, cb);
  }
  if (typeof cache === 'function') {
    cb = cache;
    cache = null;
  }
  origRealpath(p, cache, function (er, result) {
    if (newError(er)) {
      old.realpath(p, cache, cb);
    } else {
      cb(er, result);
    }
  });
}
function realpathSync(p, cache) {
  if (ok) {
    return origRealpathSync(p, cache);
  }
  try {
    return origRealpathSync(p, cache);
  } catch (er) {
    if (newError(er)) {
      return old.realpathSync(p, cache);
    } else {
      throw er;
    }
  }
}
function monkeypatch() {
  fs.realpath = realpath;
  fs.realpathSync = realpathSync;
}
function unmonkeypatch() {
  fs.realpath = origRealpath;
  fs.realpathSync = origRealpathSync;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb2R1bGUiLCJleHBvcnRzIiwicmVhbHBhdGgiLCJzeW5jIiwicmVhbHBhdGhTeW5jIiwibW9ua2V5cGF0Y2giLCJ1bm1vbmtleXBhdGNoIiwiZnMiLCJyZXF1aXJlIiwib3JpZ1JlYWxwYXRoIiwib3JpZ1JlYWxwYXRoU3luYyIsInZlcnNpb24iLCJwcm9jZXNzIiwib2siLCJ0ZXN0Iiwib2xkIiwibmV3RXJyb3IiLCJlciIsInN5c2NhbGwiLCJjb2RlIiwicCIsImNhY2hlIiwiY2IiLCJyZXN1bHQiXSwic291cmNlcyI6WyJpbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJtb2R1bGUuZXhwb3J0cyA9IHJlYWxwYXRoXG5yZWFscGF0aC5yZWFscGF0aCA9IHJlYWxwYXRoXG5yZWFscGF0aC5zeW5jID0gcmVhbHBhdGhTeW5jXG5yZWFscGF0aC5yZWFscGF0aFN5bmMgPSByZWFscGF0aFN5bmNcbnJlYWxwYXRoLm1vbmtleXBhdGNoID0gbW9ua2V5cGF0Y2hcbnJlYWxwYXRoLnVubW9ua2V5cGF0Y2ggPSB1bm1vbmtleXBhdGNoXG5cbnZhciBmcyA9IHJlcXVpcmUoJ2ZzJylcbnZhciBvcmlnUmVhbHBhdGggPSBmcy5yZWFscGF0aFxudmFyIG9yaWdSZWFscGF0aFN5bmMgPSBmcy5yZWFscGF0aFN5bmNcblxudmFyIHZlcnNpb24gPSBwcm9jZXNzLnZlcnNpb25cbnZhciBvayA9IC9edlswLTVdXFwuLy50ZXN0KHZlcnNpb24pXG52YXIgb2xkID0gcmVxdWlyZSgnLi9vbGQuanMnKVxuXG5mdW5jdGlvbiBuZXdFcnJvciAoZXIpIHtcbiAgcmV0dXJuIGVyICYmIGVyLnN5c2NhbGwgPT09ICdyZWFscGF0aCcgJiYgKFxuICAgIGVyLmNvZGUgPT09ICdFTE9PUCcgfHxcbiAgICBlci5jb2RlID09PSAnRU5PTUVNJyB8fFxuICAgIGVyLmNvZGUgPT09ICdFTkFNRVRPT0xPTkcnXG4gIClcbn1cblxuZnVuY3Rpb24gcmVhbHBhdGggKHAsIGNhY2hlLCBjYikge1xuICBpZiAob2spIHtcbiAgICByZXR1cm4gb3JpZ1JlYWxwYXRoKHAsIGNhY2hlLCBjYilcbiAgfVxuXG4gIGlmICh0eXBlb2YgY2FjaGUgPT09ICdmdW5jdGlvbicpIHtcbiAgICBjYiA9IGNhY2hlXG4gICAgY2FjaGUgPSBudWxsXG4gIH1cbiAgb3JpZ1JlYWxwYXRoKHAsIGNhY2hlLCBmdW5jdGlvbiAoZXIsIHJlc3VsdCkge1xuICAgIGlmIChuZXdFcnJvcihlcikpIHtcbiAgICAgIG9sZC5yZWFscGF0aChwLCBjYWNoZSwgY2IpXG4gICAgfSBlbHNlIHtcbiAgICAgIGNiKGVyLCByZXN1bHQpXG4gICAgfVxuICB9KVxufVxuXG5mdW5jdGlvbiByZWFscGF0aFN5bmMgKHAsIGNhY2hlKSB7XG4gIGlmIChvaykge1xuICAgIHJldHVybiBvcmlnUmVhbHBhdGhTeW5jKHAsIGNhY2hlKVxuICB9XG5cbiAgdHJ5IHtcbiAgICByZXR1cm4gb3JpZ1JlYWxwYXRoU3luYyhwLCBjYWNoZSlcbiAgfSBjYXRjaCAoZXIpIHtcbiAgICBpZiAobmV3RXJyb3IoZXIpKSB7XG4gICAgICByZXR1cm4gb2xkLnJlYWxwYXRoU3luYyhwLCBjYWNoZSlcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgZXJcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gbW9ua2V5cGF0Y2ggKCkge1xuICBmcy5yZWFscGF0aCA9IHJlYWxwYXRoXG4gIGZzLnJlYWxwYXRoU3luYyA9IHJlYWxwYXRoU3luY1xufVxuXG5mdW5jdGlvbiB1bm1vbmtleXBhdGNoICgpIHtcbiAgZnMucmVhbHBhdGggPSBvcmlnUmVhbHBhdGhcbiAgZnMucmVhbHBhdGhTeW5jID0gb3JpZ1JlYWxwYXRoU3luY1xufVxuIl0sIm1hcHBpbmdzIjoiQUFBQUEsTUFBTSxDQUFDQyxPQUFPLEdBQUdDLFFBQVE7QUFDekJBLFFBQVEsQ0FBQ0EsUUFBUSxHQUFHQSxRQUFRO0FBQzVCQSxRQUFRLENBQUNDLElBQUksR0FBR0MsWUFBWTtBQUM1QkYsUUFBUSxDQUFD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